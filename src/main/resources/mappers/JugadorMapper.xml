<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.edu.eci.arsw.f1manager.persistence.mybatis.mappers.JugadorMapper">
    <!--- No incluir estrategia en actualizacion de jugador porque el identificador de la estrategia en jugador siempre es el mismo-->
    <update id="actualizarJugador">
        UPDATE Jugador SET
            puntos = #{puntos},
            posicion = #{posicion},
            tiempo = #{tiempo},
            Automovil_idAutomovil = #{idAutomovil},
            Carrera_identificador= #{idCarrera}
        WHERE usuario=#{usuario};
    </update>
    
    <select  parameterType="map" id="consultarJugadoresPorCarrera" resultMap="CarreraResult"> 
        select 
            
            j.usuario,
            j.contrasena,
            j.puntos,
            j.posicion,
            j.tiempo,
            j.Automovil_idAutomovil,
            j.Estrategia_idEstrategia,
            j.Carrera_identificador,
        
            e.idEstrategia as Estrategia_idEstrategia,
            e.llanta as Estrategia_llanta,
            e.aerodinamico as Estrategia_aerodinamico,
            e.trasmision as Estrategia_trasmision,
            e.estilo as Estrategia_estilo
        FROM  Carrera as c left join Jugador as j on j.Carrera_identificador=c.identificador left join Estrategia as e on j.Estrategia_idEstrategia=e.idEstrategia
        WHERE c.identificador=#{identificador}
        ORDER BY j.posicion ASC;
    </select>
    
    

    <resultMap type="Jugador" id="JugadorResult">
        <id property="usuario" column="usuario"/>
        <result property="contrasena" column="contrasena"/>
        <result property="puntos" column="puntos"/>
        <result property="automovil" column="automovil"/>
        <association property="estrategia" columnPrefix="Estrategia_" resultMap="EstrategiaResult"/>
    </resultMap>
    
    <resultMap type="Estrategia" id="EstrategiaResult">
        <id property="idEstrategia" column="idEstrategia"/>
        <result property="llanta" column="llanta"/>
        <result property="aerodinamico" column="aerodinamico"/>
        <result property="trasmision" column="trasmision"/>
        <result property="estilo" column="estilo"/>
    </resultMap>

</mapper>
